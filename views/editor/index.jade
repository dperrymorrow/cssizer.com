
doctype html
html
  head
    meta(name="viewport" content="width=device-width, initial-scale=1")
    link(rel="stylesheet" href="/css/vendor.min.css" type="text/css" media="screen" charset="utf-8")
    link(rel="stylesheet" href="/icomoon/style.css" type="text/css" media="screen" charset="utf-8")
    link(rel="stylesheet" href="/less-css/app.css" type="text/css" media="screen" charset="utf-8")

    //- might should do this on the server
    - cssFile = _.findWhere(gist.files, {language: 'CSS'});
    - htmlFile = _.findWhere(gist.files, {language: 'HTML'});

    body
      .modal#save-modal
        .backdrop
        .content
          form#save-form(method="post", action= gist.id ? "/editor/#{gist.id}/update" : "/editor/create")
            input(type="hidden", name="files[CSS][filename]", value=cssFile.filename)
            textarea(rows=10, name="description", placeholder="Description")=gist.description
            input(type="hidden", name="files[HTML][filename]", value=htmlFile.filename)
            input(type="hidden", name="id", value=gist.id)
            input(type="hidden", name="files[CSS][content]")= cssFile.content
            input(type="hidden", name="files[HTML][content]")= htmlFile.content
            button.btn.btn-block(type="submit") Save

      .modal#lib-modal
        .backdrop
        .content
          this is your library of gists

      article
        header
          nav
            button#save-trigger Save
            button#lib-trigger Your gists
            a(href="/logout") logout

          if user
            .user
              span
                = user.username
              img(src=user._json.avatar_url)

        .editor
          .source
            .toggle.icon-screen-full
            .toggle.icon-screen-normal
            textarea.CSS#css= cssFile.content
          .source
            .toggle.icon-screen-full
            .toggle.icon-screen-normal
            textarea.HTML#html= htmlFile.content

        .preview
          .toggle.icon-screen-full
          .toggle.icon-screen-normal
          //- sandbox="allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts",
          iframe#iframe(sandbox="allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts", width="100%" height="100%" src="/iframe.html" frameborder="no")

      script(src="/js/vendor.min.js")
      script(src="/js/app.js")
      script(src="/js/utils.js")
      script(src="/js/lib.js")
      script(src="/js/editor.js")
      script(src="/js/preview.js")
      script(src="/js/form.js")

      script.
        CSSIZER.app.init();
